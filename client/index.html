<!DOCTYPE <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Treseta Online</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .hand0{
            position: absolute;
            top:60%;
            left:20%;
        }
        .hand1{
            position: absolute;
            top:60%;
            left:25%;
        }
        .hand2{
            position: absolute;
            top:60%;
            left:30%;
        }
        .hand3{
            position: absolute;
            top:60%;
            left:35%;
        }
        .hand4{
            position: absolute;
            top:60%;
            left:40%;
        }
        .hand5{
            position: absolute;
            top:60%;
            left:45%;
        }
        .hand6{
            position: absolute;
            top:60%;
            left:50%;
        }
        .hand7{
            position: absolute;
            top:60%;
            left:55%;
        }
        .table0{
            position: absolute;
            top:20%;
            left:30%;
        }
        .table1{
            position: absolute;
            top:20%;
            left:35%;
        }
        .table2{
            position: absolute;
            top:20%;
            left:40%;
        }
        .table3{
            position: absolute;
            top:20%;
            left:45%;
        }
        .table4{
            position: absolute;
            top:20%;
            left:50%;
        }
        .hidden{
            display:none;
        }
    </style>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
</head>
<body>
    <img id="k0" class="hand0" width="8%">
    <img id="k1" class="hand1" width="8%">
    <img id="k2" class="hand2" width="8%">
    <img id="k3" class="hand3" width="8%">
    <img id="k4" class="hand4" width="8%">
    <img id="k5" class="hand5" width="8%">
    <img id="k6" class="hand6" width="8%">
    <img id="k7" class="hand7" width="8%">
    <img id="t0" class="table0 hidden" width="8%">
    <img id="t1" class="table1 hidden" width="8%">
    <img id="t2" class="table2 hidden" width="8%">
    <img id="t3" class="table3 hidden" width="8%">
    <img id="t4" class="table4 hidden" width="8%">
    <script>
        var socket = io();
        var hand=[];
        var table=[];
        var id;
        var images=[];
        var imagesTable=[];
        var myMove = false;
        var odabir;
        var img;
        var odbaceneKarte=0;
        socket.on('message',function(data){
            console.log(data);
        });
        socket.on('identi',function(data){
            id=data.id;
        });
        socket.on('addToHand',function(data){
            hand.push(data.karta);
            console.log(data.karta)
        });
        socket.on("begin",function(data){
            hand.sort(function(a,b){return Number(a)-Number(b)});
            draw();
        });
        socket.on('yourMove',function(data){
            if (data.id == id){
                myMove = true;
            }
            else{
                myMove = false;
            }
        });
        socket.on('putToTable', function(data){
            table.push(data.card);
            console.log(data.karta)
        });
        socket.on('krajRunde', function(data){
            for (var i=0;i<5;i++){
                imagesTable[i].classList.add('hidden');
            }
            table=[];
            myMove=false;
        });
        socket.on('noonesmove', function(data){
            myMove=false;
        });
        socket.on('gameOver',function(){
            hand=[];
            for (var i=0;i<8;i++){
                images[i].classList.remove('hidden');
            }
            odbaceneKarte=0;
        });
        for(var i=0;i<8;i++){
            images.push(document.getElementById('k'+i));
        }
        for(var i=0;i<5;i++){
            imagesTable.push(document.getElementById('t'+i));
            imagesTable[i].classList.remove('hidden');
        }
        function draw(){
            for(var i=0;i<hand.length;i++){
                images[i].src='./img/'+hand[i][0]+'.jpg';
            }
            for(var i=0;i<table.length;i++){
                imagesTable[i].src='./img/'+table[i][0]+'.jpg';
                imagesTable[i].classList.remove('hidden');
            }
            requestAnimationFrame(draw);
        }
        images[0].addEventListener('click',function(){
            odabir=0;
            if(!table[0]){
                if(myMove){
                    myMove = false;
                    socket.emit('chosenCard',{id:id,card:hand[odabir]});
                    hand.splice(odabir,1);
                    document.getElementById('k'+(7-odbaceneKarte)).classList.add('hidden');
                    odbaceneKarte++;
                }
            }else if(parseInt(table[0]/10) in parseInt(hand/10)){
                if(parseInt(table[0]/10)==parseInt(hand[odabir]/10)){
                    if(myMove){
                        myMove = false;
                        socket.emit('chosenCard',{id:id,card:hand[odabir]});
                        hand.splice(odabir,1);
                        document.getElementById('k'+(7-odbaceneKarte)).classList.add('hidden');
                        odbaceneKarte++;
                    }
                }
            }else{
                if(myMove){
                    myMove = false;
                    socket.emit('chosenCard',{id:id,card:hand[odabir]});
                    hand.splice(odabir,1);
                    document.getElementById('k'+(7-odbaceneKarte)).classList.add('hidden');
                    odbaceneKarte++;
                }
            }
        })
        images[1].addEventListener('click',function(){
            odabir=1;
            odaberi(odabir);
        })
        images[2].addEventListener('click',function(){
            odabir=2;
            odaberi(odabir);
        })
        images[3].addEventListener('click',function(){
            odabir=3;
            odaberi(odabir);
        })
        images[4].addEventListener('click',function(){
            odabir=4;
            odaberi(odabir);
        })
        images[5].addEventListener('click',function(){
            odabir=5;
            odaberi(odabir);
        })
        images[6].addEventListener('click',function(){
            odabir=6;
            odaberi(odabir);
        })
        images[7].addEventListener('click',function(){
            odabir=7;
            odaberi(odabir);
        })
        function contains(karta,spil){
            for (var i=0;i<spil.length;i++){
                if (parseInt(karta/10)==parseInt(spil[i]/10)){
                    return true;
                }
            }
            return false;
        }
        function odaberi(odabirKarte){
            if(!table[0]){
                if(myMove){
                    myMove = false;
                    socket.emit('chosenCard',{id:id,card:hand[odabir]});
                    hand.splice(odabir,1);
                    document.getElementById('k'+(7-odbaceneKarte)).classList.add('hidden');
                    odbaceneKarte++;
                }
            }else if(contains(table[0],hand)){
                if(parseInt(table[0]/10)==parseInt(hand[odabir]/10)){
                    if(myMove){
                        myMove = false;
                        socket.emit('chosenCard',{id:id,card:hand[odabir]});
                        hand.splice(odabir,1);
                        document.getElementById('k'+(7-odbaceneKarte)).classList.add('hidden');
                        odbaceneKarte++;
                    }
                }
            }else{
                if(myMove){
                    myMove = false;
                    socket.emit('chosenCard',{id:id,card:hand[odabir]});
                    hand.splice(odabir,1);
                    document.getElementById('k'+(7-odbaceneKarte)).classList.add('hidden');
                    odbaceneKarte++;
                }
            }
        }
    </script>
</body>
</html>